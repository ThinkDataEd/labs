---
title: "Bootstrapping Lab"
author: "ThinkData Ed"
date: 'Directions: Follow along with the slides.  
  
  <br>
  <br>
  Space, Click, Right Arrow or swipe left to move to the next slide.'
output: 
  slidy_presentation: 
    css: ../IDSLabCSSRev.css
    mathjax: ../extras/mathjax-local/MathJax.js
---

## Introduction

**Research Question:** What is the mean age of people older than 15 living in the United States?

Today we'll use **bootstrapping** to create confidence intervals around our estimate.

**Key Concept:** A bootstrap sample is a random sample taken WITH replacement from our original data, using the same sample size.

## Load and Explore the Data
We will be using data from the American Time Use Survey. Run the following codes to load and _View_ the data.
```{r, echo = TRUE, eval = FALSE}
data(atus)
View(atus)

```

If you want some details about the data, you can get documentation with the following code:
```{r, echo = TRUE, eval = FALSE}
?(atus)
```

Since we cannot collect data from everyone who is older than 15 living in the US, our `atus` data is a sample, so any statistics we calculate using this data will be an estimate. 

Now let's determine an estimate for the average age of people older than 15 living in the US:
```{r, echo = TRUE, eval = FALSE}
mean(~age, data = atus)
```

## Let's Create One Bootstrap Sample

Let's see what one bootstrapped sample looks like. To begin, we will set a seed for reproducibility:

```{r, echo = TRUE, eval = FALSE}
set.seed(123)
```

First, we will randomly pick which observations we want. We do this by sampling the numbers 1 to 8136 (the size of the dataset) WITH replacement. 

```{r, echo = TRUE, eval = FALSE}

bs_rows <- sample(1:8136, size = 8136, replace = TRUE)
```

You just created a vector called `bs_rows` that you can find in your environment. Your first randomly selected number was 2463.

Now that we have which observations to sample, weâ€™ll use `slice()` to use these rows to create a new set of data.
```{r, echo = TRUE, eval = FALSE}
bs_atus <- slice(atus, bs_rows)
View(bs_atus)
```

Notice that the first row of `bs_atus` is the same as entry 2463, our first randomly sampled observation.

```{r, echo = TRUE, eval = FALSE}
entry2463 <- data.frame(atus[2463,])
```

Now let's find the mean of this sample:
```{r, echo = TRUE, eval = FALSE}
mean(~age, data = bs_atus)
```

## Make a Bootstrap Function
To make the process we did simple, let's create a function. 
```{r, echo = TRUE, eval = FALSE}
bs_func <- function() {
    bs_rows <- sample(1:8136, size = 8136, replace = TRUE)
    bs_atus <- slice(atus, bs_rows)
    mean(~age, data = bs_atus)
}

```

Now test it out to see. Try running it twice to see that you'll get multiple outputs.
```{r, echo = TRUE, eval = FALSE}
bs_func()
```

## Generate 2000 Bootstrap Samples

Let's run `bs_func()` 2000 times. We will use the `do()` function:
```{r, echo = TRUE, eval = FALSE}
bs_means <- do(2000)* bs_func()
View(bs_means)
```

Now let's visualize our bootstrapped means.
  - Note: This code will change your tab to "Plots" in the plots pane. Click "Viewer" to return back to the lab.
```{r, echo = TRUE, eval = FALSE}
histogram(~bs_func, data = bs_means,
          main = "Distribution of 2000 Bootstrap Sample Means")
```
  - These _bootstrapped_ estimates no longer estimate the average age of people in the U.S.
    - Instead, they estimate how much the estimate of the average age of people in the U.S. varies.
    
## Create a 90% Confidence Interval
We're ready to make our confidence interval now! If we want to find a 90% confidence interval, we can look at the middle 90% of our data. To do this, we will find the 5% quantile and the 95% quantile. 

To find the lower bound, we will run:
```{r, echo = TRUE, eval = FALSE}
quantile(~bs_func, data = bs_means, p = 0.05)
```

For your upper bound, run:
```{r, echo = TRUE, eval = FALSE}
quantile(~bs_func, data = bs_means, p = 0.95)
```

Based on your _bootstrapped_ estimates, between which two ages are we 90% confident the actual `mean` age of people living in the U.S. is contained?

Our confidence interval can be written with the format (lower bound, upper bound).

To visualize our confidence interval, we can add lines at our lower and upper bounds.
```{r, echo = TRUE, eval = FALSE}
histogram(~bs_func, data = bs_means,
          main = "Distribution of 2000 Bootstrap Sample Means")
add_line(vline=quantile(~bs_func, data = bs_means, p = 0.05))
add_line(vline=quantile(~bs_func, data = bs_means, p = 0.95))
```

## Margin of Error
Margin of error is another way we can talk about how sure we are about our results. For example:

Instead of, 
  *"I think the mean age is between 52 and 53,"* we can say, 
  *"I think the mean age is 52.5, give or take 0.5 years."*

To find our margin of error, we can find the length of our interval and divide by two.

We'll store our 5% quantile as our lower bound:
```{r, echo = TRUE, eval = FALSE}
lower_bound<-quantile(~bs_func, data = bs_means, p = 0.05,names=FALSE)
```

Similarly, let's store the 95% quantile as our upper bound:
```{r, echo = TRUE, eval = FALSE}
upper_bound<-quantile(~bs_func, data = bs_means, p = 0.95,names=FALSE)
```

Now, we can find their difference and divide by two.
```{r, echo = TRUE, eval = FALSE}
(upper_bound - lower_bound)/2
```

That is our margin of error.

## What about a 95% Confidence Interval?

We'll simply adjust our quantiles! Our lower bound now is at 2.5%:
```{r, echo = TRUE, eval = FALSE}
quantile(~bs_func, data = bs_means, p = 0.025)
```

Our upper found will be at 97.5%.
```{r, echo = TRUE, eval = FALSE}
quantile(~bs_func, data = bs_means, p = 0.975)
```

Notice, the interval is wider now because we were willing to gain a little confidence for a wider interval. 

## Summary

You've now learned how to:

  - Create bootstrap samples by sampling WITH replacement
   
  - Automate the process using functions
  
  - Generate many bootstrap samples to understand sampling variability
  
  - Calculate confidence intervals using quantiles
    
  - Find margin of error.

**Key Takeaway:** A 95% confidence interval means that if we repeated this process many times, 95% of our intervals would contain the true population mean.