---
title: "Bootstrapping Lab"
author: "ThinkData Ed"
date: 'Directions: Follow along with the slides.  
  
  <br>
  <br>
  Space, Click, Right Arrow or swipe left to move to the next slide.'
output: 
  slidy_presentation: 
    css: ../IDSLabCSSRev.css
    mathjax: ../extras/mathjax-local/MathJax.js
---

## Introduction

**Research Question:** What is the mean amount of time people older than 15 living in the United States watch television?

Today we'll use **bootstrapping** to create confidence intervals around our estimate.

**Key Concept:** To build a bootstrap distribution, we repeatedly resample with replacement from the original data, ensuring each new sample is the same size, and calculate a statistic of interest many times. We can find confidence intervals by using the percentiles of this resulting distribution.

## Load and Explore the Data
We will be using data from the American Time Use Survey. Run the following codes to load and `View` the data.
```{r, echo = TRUE, eval = FALSE}
data(atus)
View(atus)

```

If you want some details about the data, you can get documentation with the following code.

Note: This code will change your tab to the _Help_ tab. Click on _Viewer_ to return back to the lab.
```{r, echo = TRUE, eval = FALSE}
?atus
```

Since we cannot collect data from everyone who is older than 15 living in the US, our `atus` data is a sample, so any statistics we calculate using this data will be an estimate. 

Now let's determine an estimate for the average time spent watching television:
```{r, echo = TRUE, eval = FALSE}
mean(~television, data = atus)
```

## Let's Create One Bootstrap Sample
Let's see what one bootstrapped sample looks like. To begin, we will set a seed for reproducibility:

```{r, echo = TRUE, eval = FALSE}
set.seed(123)
```

First, we will randomly pick which observations we want. We do this by sampling the numbers 1 to 8136 (the size of the dataset) WITH replacement. 

```{r, echo = TRUE, eval = FALSE}

bs_rows <- sample(1:8136, size = 8136, replace = TRUE)
```

You just created a vector called `bs_rows` that you can find in your environment. Your first randomly selected number was 2463.

Now that we have which observations to sample, weâ€™ll use `slice()` to use these rows to create a new set of data.
```{r, echo = TRUE, eval = FALSE}
bs_atus <- slice(atus, bs_rows)
View(bs_atus)
```

Notice that the first row of `bs_atus` is the same as entry 2463 in our original atus data, our first randomly sampled observation. Run the following to check.

```{r, echo = TRUE, eval = FALSE}
entry2463 <- data.frame(atus[2463,])
View(entry2463)
```

Now let's find the mean time spent watching television of this sample:
```{r, echo = TRUE, eval = FALSE}
mean(~television, data = bs_atus)
```

## Make a Bootstrap Function
To make the process we did easy to replicate, let's create a function. 
```{r, echo = TRUE, eval = FALSE}
bs_func <- function() {
    bs_rows <- sample(1:8136, size = 8136, replace = TRUE)
    bs_atus <- slice(atus, bs_rows)
    mean(~television, data = bs_atus)
}

```

Now test it out to see. Try running it a few times to see that you'll get multiple different outputs.
```{r, echo = TRUE, eval = FALSE}
bs_func()
```

## Generate 2000 Bootstrap Samples

Let's run `bs_func()` 2000 times. We will use the `do()` function:
```{r, echo = TRUE, eval = FALSE}
bs_means <- do(2000)* bs_func()
View(bs_means)
```

Now let's visualize our bootstrapped means.
 
 - Note: This code will change your tab to "Plots" in the plots pane. Click "Viewer" to return back to the lab.
```{r, echo = TRUE, eval = FALSE}
histogram(~bs_func, data = bs_means,
          main = "Distribution of 2000 Bootstrap Sample Means")
```
  - These _bootstrapped_ estimates no longer estimate the average time people in the U.S spend watching television.
    - Instead, they estimate how much the estimate of the average time people spend watching television in the U.S. varies.
    
## Create a 90% Confidence Interval
We're ready to make our confidence interval now! If we want to find a 90% confidence interval, we can look at the middle 90% of our data. To do this, we will find the 5% quantile and the 95% quantile. 

To find the lower bound, we will run:
```{r, echo = TRUE, eval = FALSE}
quantile(~bs_func, data = bs_means, p = 0.05)
```

For your upper bound, run:
```{r, echo = TRUE, eval = FALSE}
quantile(~bs_func, data = bs_means, p = 0.95)
```

Using your bootstrapped data, what are the upper and lower bounds that we can be 90% confident contain the average amount of time U.S. residents actually spend watching television?

Our confidence interval can be written with the format (lower bound, upper bound).

To visualize our confidence interval, we can add lines at our lower and upper bounds.
```{r, echo = TRUE, eval = FALSE}
histogram(~bs_func, data = bs_means,
          main = "Distribution of 2000 Bootstrap Sample Means")
add_line(vline=quantile(~bs_func, data = bs_means, p = 0.05))
add_line(vline=quantile(~bs_func, data = bs_means, p = 0.95))
```

## Margin of Error
Margin of error is another way we can talk about how sure we are about our results. For example:

Instead of, 
  *"I think the mean time is between 186 and 192,"* we can say, 
  *"I think the mean time is 189 give or take 3 minutes"*

To find our margin of error, we can find the length of our interval and divide by two.

We'll store our 5% quantile as our lower bound:
```{r, echo = TRUE, eval = FALSE}
lower_bound <- quantile(~bs_func, data = bs_means, p = 0.05, names=FALSE)
```

Similarly, let's store the 95% quantile as our upper bound:
```{r, echo = TRUE, eval = FALSE}
upper_bound <- quantile(~bs_func, data = bs_means, p = 0.95, names=FALSE)
```

Now, we can find their difference and divide by two.
```{r, echo = TRUE, eval = FALSE}
(upper_bound - lower_bound)/2
```

That is our margin of error.

## What about a 95% Confidence Interval?

We'll simply adjust our quantiles! Our lower bound now is at 2.5%:
```{r, echo = TRUE, eval = FALSE}
quantile(~bs_func, data = bs_means, p = 0.025)
```

Our upper found will be at 97.5%.
```{r, echo = TRUE, eval = FALSE}
quantile(~bs_func, data = bs_means, p = 0.975)
```

Notice, the interval is wider now because we were willing to gain a little confidence for a wider interval. 

## Summary

You've now learned how to:

  - Create bootstrap samples by sampling WITH replacement
   
  - Automate the process using functions
  
  - Generate many bootstrap samples to understand sampling variability
  
  - Calculate confidence intervals using quantiles
    
  - Find margin of error.

**Key Takeaway:** A 95% confidence interval means that if we repeated this process many times, 95% of our intervals would contain the true population mean.